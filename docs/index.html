<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="index_files/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<div id="header">
<div class="figure">
<img src="images/urban-institute-logo.png" />

</div>
</div>
<div id="urban-institute-r-graphics-guide" class="section level2">
<h2>Urban Institute R Graphics Guide</h2>
<p>R is a powerful, open-source programming language and environment. R excels at data management and munging, traditional statistical analysis, machine learning, and reproducible research, but it is probably best known for its graphics. This .html file made with <a href="http://rmarkdown.rstudio.com/">R Markdown</a> contains examples and instructions for popular and lesser-known plotting techniques in R. Furthermore, it includes instructions on how to leverage the Urban Institute’s ggplot2 theme which will create near-publication-ready plots.</p>
<p>The greatest strength of R is its vibrant and open community of users, developers, and educators. If you ever hit a wall, there are plenty of places to look for help. Hadley Wickham’s book, <a href="http://r4ds.had.co.nz/">R for Data Science</a>, is a comprehensive text for beginners. <a href="http://stackoverflow.com/">Stackoverflow</a> is full of questions and answers (be sure to include “[r]” in the search). Finally, don’t hesitate to contact Aaron Williams (<a href="mailto:awilliams@urban.org">awilliams@urban.org</a>).</p>
<div id="installation" class="section level4">
<h4>Installation</h4>
<p><strong>R</strong> can be added on any Urban Institute computer by IT.</p>
<p><strong>R Studio</strong> is an Integrated Development Environment that greatly expands the interface and capabilites of R. Loading R Studio is the preferred way of loading R.</p>
<p><strong>R Packages</strong> are collections of open-source code developed by R users that contain useful functions and data that expand the power and applicability of R. Packages are regularly added on <a href="https://cran.r-project.org/">CRAN</a> and <a href="https://github.com/">GitHub</a>. Most packages can be installed with <code>install.packages(&quot;package name&quot;)</code>. This only needs to happen once on each computer for each version of the package. Packages can be loaded using <code>library(package name)</code>. This needs to happen at the beginning of each script for each package used. <strong>Note:</strong> <code>install.packages()</code> uses quotation marks while <code>library()</code> does not.</p>
<p>There are thousands of packages, but most tasks can be accomplished with a handful of important packages:</p>
<ul>
<li><code>ggplot2</code> data visualization</li>
<li><code>dplyr</code> data management</li>
<li><code>tidyr</code> data tidying</li>
<li><code>readr</code> data import</li>
<li><code>purrr</code> functional programming</li>
<li><code>tibble</code> data frames</li>
<li><code>hms</code> times</li>
<li><code>stringr</code> character strings</li>
<li><code>lubridate</code> dates/times<br />
</li>
<li><code>forcats</code> factors</li>
<li><code>DBI</code> databases</li>
<li><code>haven</code> SPSS, SAS, and Stata files</li>
<li><code>httr</code> web apis</li>
<li><code>jsonlite</code> JSON</li>
<li><code>readxl</code>.xls and .xlsx</li>
<li><code>rvest</code> web scraping</li>
<li><code>xml2</code> XML</li>
<li><code>modelr</code> simple modeling within a pipeline</li>
<li><code>broom</code> turning models into tidy data</li>
<li><code>tidyverse</code> loads all of the packages listed up to this point; see Hadley Wichkham’s “<a href="https://blog.rstudio.org/2016/09/15/tidyverse-1-0-0/">tidyverse</a>”</li>
<li><code>shiny</code> interactive web applications</li>
</ul>
</div>
<div id="using-the-urban-r-theme" class="section level4">
<h4>Using the Urban R Theme</h4>
<p>Depending on your operating system, run one of the following scripts once per R session:</p>
<p><strong>Windows</strong></p>
<pre><code>source(&#39;https://raw.githubusercontent.com/UrbanInstitute/urban_R_theme/master/urban_theme_windows.R&#39;)</code></pre>
<p><strong>Mac</strong></p>
<pre><code>source(&#39;https://raw.githubusercontent.com/UrbanInstitute/urban_R_theme/master/urban_theme_mac.R&#39;)</code></pre>
<p>This is an <code>R</code> script that makes <code>ggplot2</code> output align more closely with <a href="http://urbaninstitute.github.io/graphics-styleguide/">the Urban Institute’s Data Visualization style guide</a>.</p>
<ul>
<li>This script does <strong>not produce publication ready graphics</strong>. Visual styles must still be edited using your project/paper’s normal editing workflow.
<ul>
<li><strong><em>Exporting charts as a pdf will allow them to be more easily edited</em></strong></li>
<li>You may need to tweak pdf export options to preserve fonts. For example, in RStudio on OSX, check this option in the export pdf window: <img src="images/pdf_export_option.png" width="241" /></li>
</ul></li>
<li><p>The theme has been tested against <code>ggplot2 version 2.2.0</code>. It will not function properly with older (<code>&lt; 2.0.0</code>) versions of <code>ggplot2</code></p></li>
<li>If it is not already installed, please install the free <a href="https://www.google.com/fonts/specimen/Lato">Lato font from Google fonts</a>.</li>
<li>If you’re on Windows, you’ll first need to <a href="http://ghostscript.com/download/">install Ghostscript</a>. You may need to have IT enter an admin password for this installation. Then, in R, tell R where your ghostscript file is.</li>
<li><p>Edit the file path if yours is in a different place</p>
<pre><code>Sys.setenv(R_GSCMD=&quot;C:/Program Files/gs/gs9.05/bin/gswin32c.exe&quot;)`</code></pre></li>
</ul>
<p><strong>Run this script once:</strong></p>
<pre><code>install.packages(c(&quot;ggplot2&quot;, &quot;reshape2&quot;, &quot;RColorBrewer&quot;, &quot;extrafont&quot;))
library(extrafont)
port()
loadfonts()</code></pre>
<p>Loading and importing fonts may take a few minutes.</p>
<p>After the initial installation, to use Lato just load the library in each R session:</p>
<pre><code>library(extrafont)</code></pre>
</div>
<div id="grammar-of-graphics-and-conventions" class="section level4">
<h4>Grammar of Graphics and Conventions</h4>
<p>Hadley Wickham’s ggplot2 is based on Leland Wilkinson’s <a href="https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448"><em>The Grammar of Graphics</em></a> and Wickham’s <a href="http://vita.had.co.nz/papers/layered-grammar.html"><em>A Layered Grammar of Graphics</em></a>. The layered grammar of graphics is a structured way of thinking about the components of a plot, which then lend themselves to the simple structure of ggplot2.</p>
<ul>
<li><strong>Data</strong> are what are visualizaed in a plot and <strong>mappings</strong> are directions for how data are mapped in a plot in a way that can be perceived by humans.<br />
</li>
<li><strong>Geoms</strong> are representations of the actual data like points, lines, and bars.</li>
<li><strong>Stats</strong> are statistical transformations that represent summaries of the data like histograms.</li>
<li><strong>Scales</strong> map values in the data space to values in the aesthetic space. Scales draw legends and axes.</li>
<li><strong>Coordinate Systems</strong> describe how geoms are mapped to the plane of the graphic.<br />
</li>
<li><strong>Facets</strong> break the data into meaningful subsets like small multiples.</li>
<li><strong>Themes</strong> control the finer points of a plot such as fonts, font sizes, and background colors.</li>
</ul>
<p>More information: <a href="https://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403">ggplot2: Elegant Graphics for Data Analysis</a></p>
</div>
<div id="tips-and-tricks" class="section level4">
<h4>Tips and Tricks</h4>
<ul>
<li><p><code>ggplot2</code> expects data to be in data frames. It is preferable for the data frames to be “tidy” with each variable as a column, each obseravtion as a row, and each observational unit as a separate table. <code>dplyr</code> and <code>tidyr</code> contain concise and effective tools for “tidying” data.</p></li>
<li><p>R allows function arguments to be called explicitly by name and implicitly by position. The coding examples in this guide only contain named arguments for clarity.</p></li>
<li><p>Continuous legends should be switched to vertical using <code>theme(legend.direction = &quot;vertical&quot;)</code>.</p></li>
<li><p>Graphics will sometimes render differently on different operating systems. This is because anti-aliasing is activated in R on Mac and Linux but not activated in R on Windows. <a href="https://www.r-bloggers.com/exporting-nice-plots-in-r/">This blog post</a> outlines several fixes for this problem.</p></li>
<li><p>Most features of plots can be adjusted by adding <code>theme()</code> to the end of a ggplot call. For example, a plot with a continuous legend would look like this:</p></li>
</ul>
<pre><code>ggplot(diamonds, aes(carat, price)) +
  stat_binhex(aes(colour = ..count..)) +
  theme(legend.position = &quot;right&quot;,
        legend.direction = &quot;vertical&quot;)</code></pre>
</div>
</div>
<div id="bar-plots" class="section level2">
<h2>Bar Plots</h2>
<div id="one-color" class="section level3">
<h3>One Color</h3>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(factor(cyl))) +
  geom_bar() + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, 20)) +
  labs(title = &quot;Number of Cars By Number of Cylinders&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Number of Cylinders&quot;,
       y = &quot;Count&quot;)</code></pre>
<p><img src="index_files/figure-html/barplots-1.png" width="672" /></p>
</div>
<div id="three-colors" class="section level3">
<h3>Three Colors</h3>
<p>This is identical to the previous plot except colors and a legend are added with <code>fill = factor(cyl)</code>. Turning <code>x</code> into a factor with <code>factor(cyl)</code> skips 5 and 7 on the <code>x-axis</code>. Adding <code>fill = cyl</code> without <code>factor()</code> would have created a continuous color scheme and legend.</p>
<pre class="r"><code>ggplot(data = mtcars, mapping = aes(x = factor(cyl), fill = factor(cyl))) +
  geom_bar() +
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Number of Cars By Number of Cylinders&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Number of Cylinders&quot;,
       y = &quot;Count&quot;
       ) </code></pre>
<p><img src="index_files/figure-html/3-color-barplot-1.png" width="672" /></p>
</div>
<div id="stacked-bar-plot" class="section level3">
<h3>Stacked Bar Plot</h3>
<p>An additional aesthetic can easily be added to bar plots by adding <code>fill = categorical variable</code> to the mapping. Here, diamond quality subsets each bar showing the count of diamonds with each level of clarity.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = clarity, fill = cut)) + 
  geom_bar() +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15000), labels = scales::comma) +
  labs(
    title = &quot;Diamond Clarity&quot;,
    subtitle = &quot;Something Informative About Diamonds&quot;,
    caption = &quot;The Source of Diamond Data&quot;,
    x = &quot;Clarity&quot;,
    y = &quot;Count&quot;
    )</code></pre>
<p><img src="index_files/figure-html/stacked-bar-plot-1.png" width="672" /></p>
</div>
<div id="stacked-bar-plot-with-position-fill" class="section level3">
<h3>Stacked Bar Plot With Position = Fill</h3>
<p><code>position = &quot;fill&quot;</code> in <code>geom_bar()</code> changes the y-axis from count to the proportion of each bar.</p>
<pre class="r"><code>#5 colors (stacked)
ggplot(data = diamonds, mapping = aes(x = clarity, fill = cut)) + 
  geom_bar(position = &quot;fill&quot;) +
  scale_y_continuous(expand = c(0, 0), labels = scales::percent) +
  labs(title = &quot;Better Cut Diamonds have Better Clarity&quot;,
      subtitle = &quot;Share of Diamonds with Different Qualities by Clarity of Cut&quot;,
      caption = &quot;The Source of Diamond Data&quot;,
      x = &quot;Clarity&quot;,
      y = &quot;Count&quot;)</code></pre>
<p><img src="index_files/figure-html/stacked-bar-plot-fill-1.png" width="672" /></p>
</div>
<div id="dodged-bar-plot" class="section level3">
<h3>Dodged Bar Plot</h3>
<p>Subsetted bar charts in ggplot2 are stacked by default. <code>position = &quot;dodge&quot;</code> in <code>geom_bar()</code> expands the bar chart so the bars appear next to each other.</p>
<pre class="r"><code>#5 colors (dodged)
ggplot(data = diamonds, mapping = aes(clarity, fill = cut)) + 
  geom_bar(position = &quot;dodge&quot;) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 6000), labels = scales::comma) +
  labs(title = &quot;Diamond Clarity&quot;,
       subtitle = &quot;Something Informative About Diamonds&quot;,
       caption = &quot;The Source of Diamond Data&quot;,
       x = &quot;Clarity&quot;,
       y = &quot;Count&quot;)</code></pre>
<p><img src="index_files/figure-html/dodged-bar-plot-1.png" width="672" /></p>
</div>
<div id="lollipop-plotcleveland-dot-plot" class="section level3 tabset">
<h3>Lollipop plot/Cleveland dot plot</h3>
<p>Lollipop plots and Cleveland dot plots are minimalist alternatives to bar plots. The key to both plots is to order the data based on the continuous variable using <code>arrange()</code> and then turn the discrete variable into a factor with the ordered levels of the continuous variable using <code>mutate()</code>. This step “stores” the order of the data.</p>
<div id="lollipop-plot" class="section level4">
<h4>Lollipop plot</h4>
<pre class="r"><code>mtcars %&gt;%
    rownames_to_column(&quot;model&quot;) %&gt;%
    arrange(mpg) %&gt;%
    mutate(model = factor(model, levels = .$model)) %&gt;%
    ggplot(aes(mpg, model)) +
        geom_segment(aes(x = 0, xend = mpg, y = model, yend = model)) + 
        geom_point() +
        scale_x_continuous(expand = c(0, 0), limits = c(0, max(mtcars$mpg) * 1.1)) +
        labs(title = &quot;Miles Per Gallon of Popular Cars&quot;,
                 subtitle = &quot;1974 Motor Trend US magazine&quot;,
                 x = NULL, 
                 y = &quot;Miles Per Gallon&quot;,
                 caption = &quot;Urban Institute&quot;) +
    theme(axis.text.y = element_text(size = 8))</code></pre>
<p><img src="index_files/figure-html/lollipop-plot-1.png" width="672" /></p>
</div>
<div id="cleveland-dot-plot" class="section level4">
<h4>Cleveland dot plot</h4>
<pre class="r"><code>mtcars %&gt;%
    rownames_to_column(&quot;model&quot;) %&gt;%
    arrange(mpg) %&gt;%
    mutate(model = factor(model, levels = .$model)) %&gt;%
    ggplot(aes(mpg, model)) +
        geom_point() +
        scale_x_continuous(expand = c(0, 0), limits = c(0, max(mtcars$mpg) * 1.1)) +
        labs(title = &quot;Miles Per Gallon of Popular Cars&quot;,
                 subtitle = &quot;1974 Motor Trend US magazine&quot;,
                 x = NULL, 
                 y = &quot;Miles Per Gallon&quot;,
                 caption = &quot;Urban Institute&quot;) +
    theme(axis.text.y = element_text(size = 8))</code></pre>
<p><img src="index_files/figure-html/cleveland-dot-plot-1.png" width="672" /></p>
</div>
</div>
<div id="dumbell-plot" class="section level3">
<h3>Dumbell plot</h3>
</div>
</div>
<div id="scatter-plots" class="section level2">
<h2>Scatter Plots</h2>
<div id="one-color-scatter-plot" class="section level3">
<h3>One Color Scatter Plot</h3>
<p>Scatter plots are useful for showing relationships between two or more variables.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, y = price)) + 
  geom_point() + 
  scale_y_continuous(expand = c(0, 0), labels = scales::dollar) +
  labs(title = &quot;Diamond Prices Increase With Size&quot;,
       subtitle = &quot;Diamond Prices in Dollars and Sizes in Carats&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Carat&quot;,
       y = &quot;Price&quot;
       )</code></pre>
<p><img src="index_files/figure-html/one-color-scatter-plot-1.png" width="672" /></p>
</div>
<div id="high-density-scatter-plot-with-transparency" class="section level3">
<h3>High-Density Scatter Plot with Transparency</h3>
<p>Large numbers of observations can sometimes make scatter plots tough to interpret because points overlap. Adding <code>alpha =</code> with a number between 0 and 1 adds transparency to points and clarity to plots. Now it’s easy to see that jewelry stores are probably rounding up but not rounding down carats!</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, y = price)) + 
  geom_point(alpha = 0.05) + 
  scale_y_continuous(expand = c(0, 0), labels = scales::dollar) +
  labs(title = &quot;Diamond Prices Increase With Size&quot;,
       subtitle = &quot;Diamond Prices in Dollars and Sizes in Carats&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Carat&quot;,
       y = &quot;Price&quot;
       )</code></pre>
<p><img src="index_files/figure-html/alpha-scatter-plot-1.png" width="672" /></p>
</div>
<div id="hex-scatter-plot" class="section level3">
<h3>Hex Scatter Plot</h3>
<p>Sometimes transparency isn’t enough to bring clarity to a scatter plot with many observations. As n increases into the hundreds of thousands and even millions, <code>geom_hex</code> can be one of the best ways to display relationships between two variables.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, y = price)) + 
  geom_hex(mapping = aes(fill = ..count..)) + 
  scale_y_continuous(expand = c(0, 0), labels = scales::dollar) +
    scale_fill_gradientn(colors = c(&quot;#CFE8F3&quot;, &quot;#062635&quot;), labels = scales::comma) +
  labs(title = &quot;Title&quot;,
       subtitle = &quot;geom_hex adds clarity to overlapping points&quot;,
       x = &quot;Carat&quot;,
       y = &quot;Price&quot;) +
  theme(legend.position = &quot;right&quot;,
        legend.direction = &quot;vertical&quot;)</code></pre>
<p><img src="index_files/figure-html/scatter-plot-hex-1.png" width="672" /></p>
</div>
<div id="scatter-plots-with-random-noise" class="section level3 tabset">
<h3>Scatter Plots With Random Noise</h3>
<p>Sometimes scatter plots have many overlapping points but a reasonable number of observations. <code>geom_jitter</code> adds a small amount of random noise so points are less likely to overlap. <code>width</code> and <code>height</code> control the amount of noise that is added. In the following before-and-after, notice how many more points are visible after adding jitter.</p>
<div id="before" class="section level4">
<h4>Before</h4>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = cty)) + 
  geom_point() + 
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Displacement and City MPG&quot;,
       subtitle = &quot;Cars With Less Displacement Generally Get Better City MPG&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Displacement&quot;,
       y = &quot;City MPG&quot;
       )</code></pre>
<p><img src="index_files/figure-html/before-scatter-plot-1.png" width="672" /></p>
</div>
<div id="after" class="section level4">
<h4>After</h4>
<pre class="r"><code>set.seed(2017)
ggplot(data = mpg, mapping = aes(x = displ, y = cty)) + 
  geom_jitter(width = 0.2, height = 0.2) + 
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Displacement and City MPG&quot;,
       subtitle = &quot;Cars With Less Displacement Generally Get Better City MPG&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Displacement&quot;,
       y = &quot;City MPG&quot;
       )</code></pre>
<p><img src="index_files/figure-html/jitter-plot-1.png" width="672" /></p>
</div>
</div>
<div id="scatter-plot-with-counts" class="section level3">
<h3>Scatter Plot with Counts</h3>
<p>Another option is to use <code>geom_count()</code> to add a size dimension to overlapping points.</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = cty)) + 
  geom_count() + 
  scale_y_continuous() +
  labs(title = &quot;Displacement and City MPG&quot;,
       subtitle = &quot;Cars With Less Displacement Generally Get Better City MPG&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Displacement&quot;,
       y = &quot;City MPG&quot;
  )</code></pre>
<p><img src="index_files/figure-html/geom_count-1.png" width="672" /></p>
</div>
<div id="scatter-plots-with-fill" class="section level3">
<h3>Scatter Plots with Fill</h3>
<p>A third aesthetic can be added to scatter plots. Here, color signifies the number of cylinders in each car. Before <code>ggplot()</code> is called, Cylinders is created using <code>library(dplyr)</code> and the piping operator <code>%&gt;%</code>.</p>
<pre class="r"><code>mtcars %&gt;%
  mutate(Cylinders = factor(cyl)) %&gt;%
  ggplot(mapping = aes(x = wt, y = mpg, colour = Cylinders)) + 
  geom_point(size = 3) + 
  labs(title = &quot;Fuel Efficiency Declines as Weight Increases&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Weight (Tons)&quot;,
       y = &quot;Miles Per Gallon&quot;) +
  theme(legend.title = element_text(hjust = 0))</code></pre>
<p><img src="index_files/figure-html/filled-scatter-plot-1.png" width="672" /></p>
</div>
<div id="bubble-scatter-plot" class="section level3">
<h3>Bubble Scatter Plot</h3>
<p><code>size =</code> can be used as a mapping to plot a fourth dimension.</p>
<pre class="r"><code>mtcars %&gt;%
  mutate(Cylinders = factor(cyl), `Automatic Transmission` = factor(am)) %&gt;%
  ggplot(mapping = aes(x = wt, y = mpg, color = `Automatic Transmission`, size = Cylinders)) + 
  geom_point() + 
  labs(title = &quot;Fuel Efficiency Declines as Weight Increases&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Weight (Tons)&quot;,
       y = &quot;Miles Per Gallon&quot;) +
  theme(legend.title = element_text(hjust = 0))</code></pre>
<p><img src="index_files/figure-html/bubble-chart-1.png" width="672" /></p>
</div>
</div>
<div id="line-plots" class="section level2">
<h2>Line Plots</h2>
<pre class="r"><code>ggplot(data = economics, mapping = aes(x = date, y = unemploy)) +
  geom_line() +
  scale_y_continuous(labels = scales::comma) +
  labs(title = &quot;Unemployment in the United States&quot;,
       subtitle = &quot;Number of Unemployed Americans in the U.S.&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Year&quot;, 
       y = &quot;Number Unemployed (1,000s)&quot;)</code></pre>
<p><img src="index_files/figure-html/line-plots-1.png" width="672" /></p>
<div id="lines-plots-with-multiple-lines" class="section level3">
<h3>Lines Plots With Multiple Lines</h3>
<p>Plotting more than one line can be useful for seeing the relationship of variables over time, but it takes a small amount of data munging.</p>
<p>This is because <code>ggplot2</code> wants data in a “long” format instead of a “wide” format for line plots with multiple lines. <code>gather()</code> and <code>spread()</code> from the <code>tidyr</code> package make switching back-and-forth between “long” and “wide” painless. Essentially, variable titles go into “key” and variable values go into “value”. Then ggplot2, turns the different levels of the key variable (population, unemployment) into colors.</p>
<pre class="r"><code>library(tidyverse)

economics %&gt;%
  select(date, pop, unemploy) %&gt;%
  gather(pop, unemploy, key = &quot;variable&quot;, value = &quot;value&quot;) %&gt;%
  ggplot(mapping = aes(x = date, y = value, color = variable)) +
  geom_line(size = 1) +
  scale_y_continuous(expand = c(0, 0), labels = scales::comma) +
  labs(title = &quot;Unemployment and Population&quot;,
       subtitle = &quot;Total Population and Total Unemployment in the U.S. Over Time&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Year&quot;,
       y = &quot;People (1,000s)&quot;)</code></pre>
<p><img src="index_files/figure-html/multiple-line-charts-1.png" width="672" /></p>
</div>
<div id="slope-plots" class="section level3">
<h3>Slope plots</h3>
<pre class="r"><code># https://www.bls.gov/lau/

library(ggrepel)

unemployment &lt;- tibble(
    time = c(&quot;October 2009&quot;, &quot;October 2009&quot;, &quot;October 2009&quot;, &quot;August 2017&quot;, &quot;August 2017&quot;, &quot;August 2017&quot;),
    rate = c(7.4, 7.1, 10.0, 3.9, 3.8, 6.4),
    state = c(&quot;Maryland&quot;, &quot;Virginia&quot;, &quot;Washington D.C.&quot;, &quot;Maryland&quot;, &quot;Virginia&quot;, &quot;Washington D.C.&quot;)
)

label &lt;- tibble(label = c(&quot;October 2009&quot;, &quot;August 2017&quot;))
october &lt;- filter(unemployment, time == &quot;October 2009&quot;)
august &lt;- filter(unemployment, time == &quot;August 2017&quot;)

unemployment %&gt;%
    mutate(time = factor(time, levels = c(&quot;October 2009&quot;, &quot;August 2017&quot;))) %&gt;%
    ggplot() + 
        geom_line(aes(time, rate, group = state, color = state)) +
        geom_point(aes(x = time, y = rate, color = state)) +
        labs(subtitle = &quot;Unemployment Rate&quot;,
                 caption = &quot;Source: BLS Local Area Unemployment Statistics&quot;) +
        theme(axis.ticks.x = element_blank(),
                    axis.title.x = element_blank(),
                    axis.ticks.y = element_blank(),
          axis.title.y = element_blank(), 
          axis.text.y = element_blank(),
                    panel.grid.major.y = element_blank(),
          panel.grid.minor.y = element_blank(),
          panel.grid.major.x = element_blank(),
                    axis.line = element_blank()) +
        geom_text_repel(data = october, mapping = aes(x = time, y = rate, label = as.character(rate)), nudge_x = -0.06, family = &quot;Lato&quot;) + 
        geom_text_repel(data = august, mapping = aes(x = time, y = rate, label = as.character(rate)), nudge_x = 0.06, family = &quot;Lato&quot;)</code></pre>
<p><img src="index_files/figure-html/slope-plot-1.png" width="672" /></p>
</div>
</div>
<div id="binning" class="section level2">
<h2>Binning</h2>
<p>Histograms and frequency polygons show the distribution of a single numeric variable. Both bin variables and then count the number of observations in a bin. Histograms display distributions with a bar as a geom and frequency polygons show distributions with the line geom. Frequency polygons can be easily layered.</p>
<div id="histogram" class="section level3">
<h3>Histogram</h3>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = depth)) + 
  geom_histogram(bins = 100) +
  scale_y_continuous(expand = c(0, 0), labels = scales::comma) +
  labs(title = &quot;Distribution of Diamond Depths&quot;,
       caption = &quot;Urban Institute&quot;, 
       x = &quot;Depth&quot;,
       y = &quot;Count&quot;)</code></pre>
<p><img src="index_files/figure-html/histogram-1.png" width="672" /></p>
<pre class="r"><code>diamonds %&gt;%
  filter(cut == &quot;Fair&quot; | cut == &quot;Premium&quot;) %&gt;%
  ggplot(mapping = aes(x = depth, fill = cut)) + 
  geom_histogram(bins = 100) +
  scale_y_continuous(expand = c(0, 0), labels = scales::comma) +
  labs(title = &quot;Distribution of Diamond Depths and Quality&quot;,
       caption = &quot;Urban Institute&quot;, 
       x = &quot;Depth&quot;,
       y = &quot;Count&quot;)</code></pre>
<p><img src="index_files/figure-html/histogram-2.png" width="672" /></p>
</div>
<div id="frequency-polygon" class="section level3">
<h3>Frequency Polygon</h3>
<pre class="r"><code>population %&gt;%
  filter(year == 2013 &amp; population &lt; 3000000) %&gt;%
  ggplot(mapping = aes(x = population)) + 
  geom_freqpoly() +
  scale_y_continuous(expand = c(0, 0)) +
  scale_x_continuous(labels = scales::comma) +
  labs(title = &quot;Populations of World Countries&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Population&quot;,
       y = &quot;Count&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/frequency-polygon-1.png" width="672" /></p>
<pre class="r"><code>diamonds %&gt;%
  filter(cut == &quot;Ideal&quot; | cut == &quot;Premium&quot;) %&gt;%
  ggplot(aes(x = price, color = cut)) +
  geom_freqpoly(size = 1) +
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::dollar) +
  labs(title = &quot;Distribution of Diamond Prices and Diamond Cut&quot;,
       caption = &quot;Urban Institue&quot;,
       x = &quot;Price&quot;,
       y = &quot;Count&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="index_files/figure-html/frequency-polygon-2.png" width="672" /></p>
</div>
<div id="ridgeline-plots" class="section level3">
<h3>Ridgeline plots</h3>
<p>Ridgeline plots are partially overlapping histograms faceted by a categorical variable that pack a lot of information into one compact plot.</p>
<pre class="r"><code>library(ggridges)

ggplot(diamonds, mapping = aes(x = price, y = cut)) +
    geom_density_ridges(fill = &quot;#1696d2&quot;) +
    scale_x_continuous(labels = scales::dollar) +
  labs(title = &quot;Distribution of Diamond Prices by Diamond Cut&quot;,
       caption = &quot;Urban Institue&quot;,
       x = &quot;Price&quot;,
       y = &quot;Cut&quot;)</code></pre>
<pre><code>## Picking joint bandwidth of 458</code></pre>
<p><img src="index_files/figure-html/ridgeline-plots-1.png" width="672" /></p>
</div>
<div id="categorical-variables" class="section level3">
<h3>Categorical Variables</h3>
<p>The following plots are effective at displaying how a continuous or discrete variable varies across different levels of a categorical variable.</p>
</div>
<div id="box-plot" class="section level3">
<h3>Box Plot</h3>
<pre class="r"><code>ggplot(InsectSprays, aes(x = spray, y = count)) +
  geom_boxplot() +
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Number of Insects Killed by Insect Sprays&quot;,
       caption = &quot;Urban Institute&quot;, 
       x = &quot;Type of Insect Spray&quot;,
       y = &quot;Number of Dead Insects&quot;)</code></pre>
<p><img src="index_files/figure-html/box-plot-1.png" width="672" /></p>
</div>
<div id="violin-plot" class="section level3">
<h3>Violin Plot</h3>
<pre class="r"><code>ggplot(InsectSprays, aes(x = spray, y = count, fill = spray)) +
  geom_violin() +
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Number of Insects Killed by Insect Sprays&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Type of Insect Spray&quot;,
       y = &quot;Number of Dead Insects&quot;)</code></pre>
<p><img src="index_files/figure-html/violin%20plot-1.png" width="672" /></p>
</div>
<div id="binned-dot-plots" class="section level3">
<h3>Binned dot plots</h3>
<p>TODO(aaron):</p>
</div>
<div id="bean-plots" class="section level3">
<h3>Bean Plots</h3>
<p>TODO(aaron): Add bean plots</p>
</div>
</div>
<div id="area-plot" class="section level2">
<h2>Area Plot</h2>
<div id="stacked-area" class="section level3">
<h3>Stacked Area</h3>
<pre class="r"><code>txhousing %&gt;%
  filter(city %in% c(&quot;Austin&quot;,&quot;Houston&quot;,&quot;Dallas&quot;,&quot;San Antonio&quot;,&quot;Fort Worth&quot;)) %&gt;%
  group_by(city, year) %&gt;%
  summarize(sales = sum(sales)) %&gt;%
  ggplot(aes(x = year, y = sales, fill = city)) +
    geom_area(position = &quot;stack&quot;) +
    scale_y_continuous(expand = c(0, 0), labels = scales::comma) +
    labs(title = &quot;Home Sales in Texas Cities&quot;,
         caption = &quot;Urban Institute&quot;,
         x = &quot;Year&quot;,
         y = &quot;Home Sales&quot;)</code></pre>
<p><img src="index_files/figure-html/area%20plot%20stack-1.png" width="672" /></p>
</div>
<div id="filled-area" class="section level3">
<h3>Filled Area</h3>
<pre class="r"><code>txhousing %&gt;%
  filter(city == &quot;Austin&quot; | city == &quot;Houston&quot;| city == &quot;Dallas&quot;| city == &quot;San Antonio&quot; | city == &quot;Fort Worth&quot;) %&gt;%
  group_by(city, year) %&gt;%
  summarize(listings = sum(listings)) %&gt;%
  mutate(listings = ifelse(is.na(listings), lag(listings), listings)) %&gt;%
  ggplot(aes(x = year, y = listings, fill = city)) +
    geom_area(position = &quot;fill&quot;) +
    scale_y_continuous(expand = c(0, 0), labels = scales::comma) +
    labs(title = &quot;Home Listings in Texas Cities&quot;,
         caption = &quot;Urban Institute&quot;,
         x = &quot;Year&quot;,
         y = &quot;Proportion of Home Listings&quot;)</code></pre>
<p><img src="index_files/figure-html/area%20plot%20fill-1.png" width="672" /></p>
</div>
</div>
<div id="waffle-chart-square-pie-chart" class="section level2">
<h2>Waffle Chart / Square Pie Chart</h2>
<p>The waffle package {<a href="https://cran.r-project.org/web/packages/waffle/waffle.pdf">CRAN</a> and <a href="https://github.com/hrbrmstr/waffle">Github</a>} creates suare pie charts. It can also be combined with <a href="http://fontawesome.io/">glyphs</a> for more elegant shapes than squares. This example uses data pulled from <a href="http://www.urban.org/features/vision-equitable-dc">A Vision for an Equitable DC</a>.</p>
<p>Waffle charts will require a little extra tinkering since they are called from <code>library(waffle)</code> instead of <code>library(ggplot2)</code>. Most importantly, waffle charts require <code>theme_urban(text = element_text(family = &quot;Lato&quot;))</code> for the Lato font.</p>
<div id="single-waffle-chart" class="section level3">
<h3>Single Waffle Chart</h3>
<pre class="r"><code>library(waffle)

parts &lt;- c(`Virginia\nClinics` = (1000 - 208 - 105), `Maryland\nClinics` = 208, `D.C.\nClinics` = 105)
waffle(parts, rows = 25, size = 1, colors = c(&quot;#1696d2&quot;, &quot;#fdbf11&quot;, &quot;#000000&quot;), legend_pos = &quot;bottom&quot;) +
  labs(title = &quot;Free Clinics in the D.C.-Maryland-Virginia Area&quot;,
       subtitle = &quot;1 Square == 1 Clinic&quot;,
       caption = &quot;Urban Institute&quot;) +
  theme(text = element_text(family = &quot;Lato&quot;))</code></pre>
<p><img src="index_files/figure-html/single%20waffle-1.png" width="672" /></p>
</div>
<div id="waffle-charts-with-glyphs" class="section level3">
<h3>Waffle Charts with Glyphs</h3>
<p>Waffle charts can be enhanced by replacing squares qith glyphs. Two important arguments to know are <code>glyph_size =</code> and <code>use_glyph =</code>. Both are called in the <code>waffle()</code> function. Note: <code>size = 1</code> is sensible and <code>glyph_size = 12</code> is sensible.</p>
<p>Using glyphs requires downloading fontawesome. That can be done <a href="https://github.com/hrbrmstr/waffle/tree/master/inst/fonts">here</a>. Then run <code>library(extrafont)</code>, <code>port(&lt;font-location&gt;)</code>, and <code>loadfonts()</code> once. After that, building waffle charts with glpyhs should be as easy as one function call.</p>
<pre class="r"><code>#library(extrafont)
#font_import(&quot;H:/IT/urban_R_theme/docs&quot;)
#loadfonts()

parts &lt;- c(`Virginia\nClinics` = (50 - 10 - 5), `Maryland\nClinics` = 10, `D.C.\nClinics` = 5)
waffle(parts, rows = 5, glyph_size = 12, colors = c(&quot;#1696d2&quot;, &quot;#fdbf11&quot;, &quot;#000000&quot;), legend_pos = &quot;bottom&quot;, use_glyph = &quot;medkit&quot;) +
  labs(title = &quot;Free Clinics in the D.C.-Maryland-Virginia Area&quot;,
       subtitle = &quot;1 Square == 20 Clinics&quot;,
       caption = &quot;Urban Institute&quot;) +
  theme(text = element_text(family = &quot;Lato&quot;))</code></pre>
<p><img src="index_files/figure-html/waffle%20with%20glyphs-1.png" width="672" /></p>
</div>
<div id="multiple-waffle-charts" class="section level3">
<h3>Multiple Waffle Charts</h3>
<p><code>library(waffle)</code> allows multiple waffle charts to be ironed together using <code>iron()</code>. Ironing multiple charts together requires some trial-and-error to get the sizes and resolution to look good, but the results can be worth the work. Don’t forget <code>theme(text = element_text(family = &quot;Lato&quot;))</code>!</p>
<pre class="r"><code>library(waffle)

white &lt;- c(`With Degree` = 169300, `Without Degree` = 800)
black &lt;- c(`With Degree` = 174900, `Without Degree` = 34700)
hispanic &lt;- c(`With Degree` = 27700, `Without Degree` = 12400)

iron(
  waffle(white / 83, rows = 40, size = 0.25, colors = c(&quot;#1696d2&quot;, &quot;#fdbf11&quot;), title = &quot;White&quot;, keep = FALSE, pad = 10) + 
  theme(text = element_text(family = &quot;Lato&quot;)),
  waffle(black / 83, rows = 40, size = 0.25, colors = c(&quot;#1696d2&quot;, &quot;#fdbf11&quot;), title = &quot;Black&quot;, keep = FALSE) + 
  theme(text = element_text(family = &quot;Lato&quot;)),
  waffle(hispanic / 83, rows = 40, size = 0.25, colors = c(&quot;#1696d2&quot;, &quot;#fdbf11&quot;), title = &quot;Hispanic&quot;, keep = FALSE, pad = 59, xlab = &quot;1 Square == 83 People&quot;) + 
  theme(text = element_text(family = &quot;Lato&quot;))
) </code></pre>
<p><img src="index_files/figure-html/ironed%20waffle-1.png" width="672" /></p>
</div>
</div>
<div id="heat-map" class="section level2">
<h2>Heat map</h2>
<pre class="r"><code>library(fivethirtyeight)

bad_drivers %&gt;%
  mutate(`Number of Drivers` = scale(num_drivers),
         `Percent Speeding` = scale(perc_speeding),
         `Percent Alcohol` = scale(perc_alcohol),
         `Percent Not Distracted` = scale(perc_not_distracted),
         `Percent No Previous` = scale(perc_no_previous),
         state = factor(state, levels = rev(state))
         ) %&gt;%
  select(-insurance_premiums, -losses, -(num_drivers:losses)) %&gt;%
  gather(`Number of Drivers`:`Percent No Previous`, key = &quot;variable&quot;, value = &quot;SD&#39;s from Mean&quot;) %&gt;%
  ggplot(aes(variable, state)) +
    geom_tile(aes(fill = `SD&#39;s from Mean`)) +
    labs(title = &quot;Drivers Involved in Fatal Collisions By Behavior&quot;,
      subtitle = &quot;As a share of scaled fatal collisions per billion miles, 2009&quot;,
      caption = &quot;Source: fivethirtyeight R package&quot;,
      x = NULL,
      y = NULL) + 
    scale_fill_gradient(low = &quot;white&quot;, high = &quot;#1696d2&quot;) +
    theme(legend.position = &quot;right&quot;,
      legend.direction = &quot;vertical&quot;,
      axis.text.x = element_text(angle = 45))</code></pre>
<p><img src="index_files/figure-html/heat%20map-1.png" width="672" /></p>
<pre class="r"><code>#https://learnr.wordpress.com/2010/01/26/ggplot2-quick-heatmap-plotting/</code></pre>
</div>
<div id="faceting" class="section level2">
<h2>Faceting</h2>
<pre class="r"><code>##Facet Grid
mtcars %&gt;%
    mutate(vs = factor(vs, levels = 0:1, labels = c(&quot;Normal Transmission&quot;, &quot;V/S Transmission&quot;)),
                 am = factor(am, levels = 0:1, labels = c(&quot;Automatic Transmission&quot;, &quot;Manual Transmission&quot;))) %&gt;%
    ggplot(aes(wt, mpg)) +
        geom_point(alpha = 0.5) +
        scale_y_continuous(expand = c(0, 0), limits = c(0, 45)) +
    labs(title = &quot;Determinants of Fuel Efficiency&quot;, 
             subtitle = &quot;1974 Motor Trends US magazine data&quot;, 
        caption = &quot;Urban Institute&quot;) +
    facet_grid(vs ~ am, margins = TRUE) +
        theme(panel.border = element_rect(colour = &quot;black&quot;, fill = NA, size = 0.3))</code></pre>
<p><img src="index_files/figure-html/faceting-1.png" width="672" /></p>
</div>
<div id="small-multiples" class="section level2">
<h2>Small Multiples</h2>
<div id="facet_wrap" class="section level3">
<h3>facet_wrap()</h3>
<p>R’s faceting system is a powerful way to make “small multiples”.</p>
<p>Some edits to the theme may be necessary depending upon how many rows and columns are in the plot.</p>
<pre class="r"><code># Facet Wrap
diamonds %&gt;%
    group_by()
    ggplot(cut)</code></pre>
<pre class="r"><code># Facet Wrap
txhousing %&gt;%
  filter(!city %in% c(&quot;Brazoria County&quot;, &quot;Brownsville&quot;, &quot;San Angelo&quot;, &quot;Denton County&quot;)) %&gt;%
  ggplot(aes(x = median)) +
  geom_histogram() +
  facet_wrap(~city) +
  scale_x_continuous(labels = scales::dollar) +
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Median Monthly Home Prices in Selected Texas Cities&quot;,
       x = &quot;Median Monthly Home Value&quot;,
       y = &quot;Count&quot;) + 
  theme(axis.text.x = element_text(angle = 90),
        strip.text = element_text(face = &quot;plain&quot;, 
                              size = rel(0.5)))</code></pre>
<p><img src="index_files/figure-html/small%20multiples-1.png" width="672" /></p>
</div>
<div id="facet_grid" class="section level3">
<h3>facet_grid()</h3>
<pre class="r"><code># Facet Wrap
txhousing %&gt;%
  filter(!city %in% c(&quot;Brazoria County&quot;, &quot;Brownsville&quot;, &quot;San Angelo&quot;, &quot;Denton County&quot;)) %&gt;%
  ggplot(aes(x = median)) +
  geom_histogram() +
  facet_grid(~city) +
  scale_x_continuous(labels = scales::dollar) +
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;Median Monthly Home Prices in Selected Texas Cities&quot;,
       x = &quot;Median Monthly Home Value&quot;,
       y = &quot;Count&quot;) + 
  theme(axis.text.x = element_text(angle = 90),
        strip.text = element_text(face = &quot;plain&quot;, 
                              size = rel(0.5)))</code></pre>
<p><img src="index_files/figure-html/facet%20grid-1.png" width="672" /></p>
<pre class="r"><code>#TODO(aaron): finish this</code></pre>
</div>
</div>
<div id="smoothers" class="section level2">
<h2>Smoothers</h2>
<p><code>geom_smooth()</code> fits and plots models to data with two or more dimensions.</p>
<pre class="r"><code>ggplot(data = mpg) +
    geom_smooth(mapping = aes(x = displ, y = hwy))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="index_files/figure-html/geom_smooth-1.png" width="672" /></p>
<p>Understanding and manipulating defaults is more important for <code>geom_smooth()</code> than other geoms because it contains a number of assumptions. <code>geom_smooth()</code> automatically uses loess for datasets with fewer than 1,000 observations and a generalized additive model with <code>formula = y ~ s(x, bs = &quot;cs&quot;)</code> for datasets with greater than 1,000 observations. Both default to a 95% confidence interval with the confidence interval displayed.</p>
<p>Models are chosen with <code>method =</code> and can be set to lm(), glm(), gam(), loess(), rlm(), and more. Formulas can be specified with <code>formula =</code> and <code>y ~ x</code> syntax. Plotting the standard error is toggled with <code>se = TRUE</code> and <code>se = FALSE</code>, and level is specificed with <code>level =</code>. As always, more information can be seen in RStudio with <code>?geom_smooth()</code>.</p>
<p><code>geom_point()</code> adds a scatterplot to <code>geom_smooth()</code>. The order of the function calls is important. The function called second will be layed on top of the function called first.</p>
<pre class="r"><code>ggplot(data = diamonds, mapping = aes(x = carat, y = price)) +
    geom_point(alpha = 0.1) +
    geom_smooth(color =  &quot;#ec008b&quot;) +
    scale_y_continuous(expand = c(0, 0), labels = scales::dollar)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39;</code></pre>
<p><img src="index_files/figure-html/geom_smooth2-1.png" width="672" /></p>
<p><code>geom_smooth</code> can be subset by categorical and factor variables. This requires subgroups to have a decent number of observations and and a fair amount of variability across the x-axis. Confidence intervals often widen at the ends so special care is needed for the chart to be meaningful and readable.</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = factor(cyl))) +
    geom_point(alpha = 0.2) +
    geom_smooth() +
    labs(title = &quot;Engine Displacement and City MPG by Number of Cylinders&quot;,
             subtitle = &quot;Loess: MPG = Displacement&quot;,
             caption = &quot;Urban Institute&quot;,
             x = &quot;Engine Displacement&quot;,
             y = &quot;Highway MPG&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="index_files/figure-html/subset%20geom_smooth-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) +
    geom_smooth(method = &quot;lm&quot;) +
    geom_point(alpha = 0.2) +
    labs(title = &quot;Engine Displacement and City MPG by Drive&quot;,
             subtitle = &quot;Linear Model: MPG = Displacement&quot;,
             caption = &quot;Urban Institute&quot;,
             x = &quot;Engine Displacement&quot;,
             y = &quot;Highway MPG&quot;)</code></pre>
<p><img src="index_files/figure-html/subset%20geom_smooth-2.png" width="672" /></p>
</div>
<div id="highlighting" class="section level2">
<h2>Highlighting</h2>
<p>points polygons lines</p>
</div>
<div id="text" class="section level2">
<h2>Text</h2>
<div id="libraryggplot2" class="section level3 tabset">
<h3>library(ggplot2)</h3>
<p><code>geom_text()</code> and <code>geom_label()</code> annotate points on scatterplots. Both functions need <code>x</code> values, <code>y</code> values, and a vector of labels. It’s rarely useful to label every point. Use <code>filter()</code> to create a second data set that is subsetted and pass it into the labelling function.</p>
<p><code>geom_text()</code> labels points without backgrounds. <code>geom_label()</code> labels points with backgrounds.</p>
<p><em>Note:</em> <code>family = &quot;Lato&quot;</code> is required to turn <code>geom_text()</code> into Lato.</p>
<div id="geom_text" class="section level4">
<h4>geom_text()</h4>
<pre class="r"><code>labels &lt;- mtcars %&gt;%
    rownames_to_column(&quot;model&quot;) %&gt;%
    filter(model %in% c(&quot;Toyota Corolla&quot;, &quot;Merc 240D&quot;, &quot;Datsun 710&quot;))

mtcars %&gt;%
    ggplot(mapping = aes(x = wt, y = mpg)) +
        geom_point() +
        geom_text(data = labels, mapping = aes(x = wt, y = mpg, label = model), nudge_x = 0.38, family = &quot;Lato&quot;) +
      labs(title = &quot;Fuel Efficiency Declines as Weight Increases&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Weight (Tons)&quot;,
       y = &quot;Miles Per Gallon&quot;)</code></pre>
<p><img src="index_files/figure-html/scatterplot-geom_text-1.png" width="672" /></p>
</div>
<div id="geom_label" class="section level4">
<h4>geom_label()</h4>
<pre class="r"><code>labels &lt;- mtcars %&gt;%
    rownames_to_column(&quot;model&quot;) %&gt;%
    filter(model %in% c(&quot;Toyota Corolla&quot;, &quot;Merc 240D&quot;, &quot;Datsun 710&quot;))

mtcars %&gt;%
    ggplot(mapping = aes(x = wt, y = mpg)) +
        geom_point() +
        geom_label(data = labels, mapping = aes(x = wt, y = mpg, label = model), family = &quot;Lato&quot;, nudge_x = 0.35) +
      labs(title = &quot;Fuel Efficiency Declines as Weight Increases&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Weight (Tons)&quot;,
       y = &quot;Miles Per Gallon&quot;)</code></pre>
<p><img src="index_files/figure-html/scatterplot-geom_label-1.png" width="672" /></p>
</div>
</div>
<div id="libraryggrepel" class="section level3 tabset">
<h3>library(ggrepel)</h3>
<p>Text too often overlaps when using <code>geom_text()</code> or <code>geom_label()</code>. <code>library(ggrepel)</code> is a <code>library(ggplot2)</code> add-on that automatically positions text so it doesn’t overlap with geoms or other text.</p>
<p>To add this functionalit simple load <code>library(ggrepel)</code> and then use <code>geom_text_repel()</code> and <code>geom_text_label()</code> with the same syntax as <code>geom_text()</code> and <code>geom_label()</code>. Don’t roget to add <code>family = &quot;Lato&quot;</code>.</p>
<div id="geom_text_repel" class="section level4">
<h4>geom_text_repel()</h4>
<pre class="r"><code>library(ggrepel)

labels &lt;- mtcars %&gt;%
    rownames_to_column(&quot;model&quot;) %&gt;%
    filter(model %in% c(&quot;Toyota Corolla&quot;, &quot;Merc 240D&quot;, &quot;Datsun 710&quot;))

mtcars %&gt;%
    ggplot(mapping = aes(x = wt, y = mpg)) +
        geom_point() +
        geom_text_repel(data = labels, mapping = aes(x = wt, y = mpg, label = model), nudge_x = 0.38, family = &quot;Lato&quot;) +
      labs(title = &quot;Fuel Efficiency Declines as Weight Increases&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Weight (Tons)&quot;,
       y = &quot;Miles Per Gallon&quot;)</code></pre>
<p><img src="index_files/figure-html/scatterplot-geom_text_repel-1.png" width="672" /></p>
</div>
<div id="geom_label_repel" class="section level4">
<h4>geom_label_repel()</h4>
<pre class="r"><code>labels &lt;- mtcars %&gt;%
    rownames_to_column(&quot;model&quot;) %&gt;%
    filter(model %in% c(&quot;Toyota Corolla&quot;, &quot;Merc 240D&quot;, &quot;Datsun 710&quot;))

mtcars %&gt;%
    ggplot(mapping = aes(x = wt, y = mpg)) +
        geom_point() +
        geom_label_repel(data = labels, mapping = aes(x = wt, y = mpg, label = model), family = &quot;Lato&quot;, nudge_x = 0.35) +
      labs(title = &quot;Fuel Efficiency Declines as Weight Increases&quot;,
       caption = &quot;Urban Institute&quot;,
       x = &quot;Weight (Tons)&quot;,
       y = &quot;Miles Per Gallon&quot;)</code></pre>
<p><img src="index_files/figure-html/scatterplot-geom_label_repel-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="layered-geoms" class="section level2">
<h2>Layered Geoms</h2>
<p>Geoms can be layered in <code>ggplot2</code>. This is useful for design and analysis.</p>
<p>It is often useful to add points to line plots with a small number of values across the x-axis. This example from <a href="http://r4ds.had.co.nz/tidy-data.html">R for Data Science</a> shows how changing the line to grey can be appealing.</p>
<div id="design" class="section level3 tabset">
<h3>Design</h3>
<div id="before-1" class="section level4">
<h4>Before</h4>
<pre class="r"><code>table1 %&gt;%
    ggplot(aes(x = year, y = cases)) +
        geom_line(aes(color = country)) +
        geom_point(aes(color = country)) +
        scale_y_continuous(labels = scales::comma) +
        scale_x_continuous(breaks = c(1999, 2000)) +
        labs(title = &quot;Changes in Tuberculosis Cases in Three Countries&quot;,
                     caption = &quot;Source: World Health Organization Global Tuberculosis Report&quot;)</code></pre>
<p><img src="index_files/figure-html/layering%20geoms%20design-1.png" width="672" /></p>
</div>
<div id="after-1" class="section level4">
<h4>After</h4>
<pre class="r"><code>table1 %&gt;%
    ggplot(aes(year, cases)) +
        geom_line(aes(group = country), color = &quot;grey50&quot;) +
        geom_point(aes(color = country)) +
        scale_y_continuous(labels = scales::comma) +
        scale_x_continuous(breaks = c(1999, 2000)) +
        labs(title = &quot;Changes in Tuberculosis Cases in Three Countries&quot;,
                     caption = &quot;Source: World Health Organization Global Tuberculosis Report&quot;)</code></pre>
<p><img src="index_files/figure-html/layering%20geoms%20design%20grey-1.png" width="672" /></p>
<p>Layering geoms is also useful for adding trend lines and centroids to scatter plots.</p>
<pre class="r"><code># Simple line
# Regression model
# Centroids</code></pre>
</div>
</div>
<div id="centroids" class="section level3">
<h3>Centroids</h3>
<pre class="r"><code>mpg_summary &lt;- mpg %&gt;%
    group_by(cyl) %&gt;%
    summarize(displ = mean(displ), cty = mean(cty))

mpg %&gt;%
    ggplot() +
        geom_point(aes(x = displ, y = cty, color = factor(cyl)), alpha = 0.5) +
        geom_point(data = mpg_summary, aes(x = displ, y = cty), size = 5, color = &quot;red&quot;) +
        geom_text(data = mpg_summary, aes(x = displ, y = cty, label = cyl)) +
        labs(title = &quot;City MPG, Engine Displacement, and Number of Cylinders&quot;, 
                 subtitle = &quot;Subgroup Means in Red&quot;, 
                 caption = &quot;Source: EPA Fuel Economy Dataset&quot;, 
                 x = &quot;Displacement&quot;,
                 y = &quot;City MPG&quot;)</code></pre>
<p><img src="index_files/figure-html/centroids-1.png" width="672" /></p>
</div>
</div>
<div id="shiny" class="section level2">
<h2>Shiny</h2>
</div>
<div id="ggvis" class="section level2">
<h2>ggvis</h2>
<p><a href="http://ggvis.rstudio.com/">ggvis</a> is Hadley Wickham’s successor to <code>ggplot2</code>. It incorporates what he has learned over the past decade and extends to include web and interactive graphics. The package is available, but it is still very much in development. <code>ggplot2</code> is still the best way to make graphics in R.</p>
<p>Functionality that is added to <code>ggvis</code> that isn’t possible in <code>ggplot</code> will be added to this section in the future. ## Saving plots</p>
<p>todo(aaron): make the case for svg and pdf png</p>
</div>
<div id="appendix" class="section level2">
<h2>Appendix</h2>
<div id="system-info-and-package-versioning" class="section level3">
<h3>System Info and Package Versioning</h3>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.4.2 (2017-09-28)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Sierra 10.12.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] fivethirtyeight_0.3.0 waffle_0.7.0          ggridges_0.4.1       
##  [4] ggrepel_0.7.0         hexbin_1.27.1         bindrcpp_0.2         
##  [7] extrafont_0.17        RColorBrewer_1.1-2    dplyr_0.7.4          
## [10] purrr_0.2.4           readr_1.1.1           tidyr_0.7.2          
## [13] tibble_1.3.4          ggplot2_2.2.1         tidyverse_1.1.1      
## [16] knitr_1.17           
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_0.2.2 reshape2_1.4.2   haven_1.1.0      lattice_0.20-35 
##  [5] colorspace_1.3-2 htmltools_0.3.6  mgcv_1.8-20      yaml_2.1.14     
##  [9] rlang_0.1.2      foreign_0.8-69   glue_1.1.1       modelr_0.1.1    
## [13] readxl_1.0.0     bindr_0.1        plyr_1.8.4       stringr_1.2.0   
## [17] munsell_0.4.3    gtable_0.2.0     cellranger_1.1.0 rvest_0.3.2     
## [21] psych_1.7.8      evaluate_0.10.1  labeling_0.3     forcats_0.2.0   
## [25] parallel_3.4.2   Rttf2pt1_1.3.4   broom_0.4.2      Rcpp_0.12.13    
## [29] scales_0.5.0     backports_1.1.1  jsonlite_1.5     gridExtra_2.3   
## [33] mnormt_1.5-5     hms_0.3          png_0.1-7        digest_0.6.12   
## [37] stringi_1.1.5    rprojroot_1.2    tools_3.4.2      magrittr_1.5    
## [41] lazyeval_0.2.0   extrafontdb_1.0  pkgconfig_2.0.1  Matrix_1.2-11   
## [45] xml2_1.1.1       lubridate_1.6.0  assertthat_0.2.0 rmarkdown_1.6   
## [49] httr_1.3.1       R6_2.2.2         nlme_3.1-131     compiler_3.4.2</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
